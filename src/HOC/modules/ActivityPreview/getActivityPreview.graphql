
query getActivityPreview($activityId: String!) {
    activity(activityId: $activityId) {
        ...ActivityPreviewData
    }
}

fragment ActivityPreviewData on Activity {
    createdAt
    id
    verb
    user {
        ...ActivityPreviewUserCtx
    }
    context {
        __typename

        ... on Collection{
            ...ActivityPreviewCollectionCtx
        }

        ... on Comment{
            ...ActivityPreviewCommentCtxExtended
        }

        ... on Community{
            ...ActivityPreviewCommunityCtx
        }

        ... on Resource{
            ...ActivityPreviewResourceCtx
        }

        ... on Flag{
            ...ActivityPreviewFlagCtx
        }

        ... on Like{
            ...ActivityPreviewLikeCtx
        }

        ... on Follow{
            ...ActivityPreviewFollowCtx
        }

        ... on User{
            ...ActivityPreviewUserCtx
        }

    }
}

fragment ActivityPreviewUserCtx on User {
    icon
    image
    userId: id 
    userName: name
    isLocal
    summary
    canonicalUrl
    myFollow {
        id
    }
    likerCount
    myLike{
        id
    }
    myFlag{
        id
    }
}


fragment ActivityPreviewBaseThread on Thread {
    id
    isLocal
    canonicalUrl
}

fragment ActivityPreviewCollectionCtx on Collection{
    id
    isLocal
    icon
    name
    summary
    canonicalUrl
    community{
        id
        myFollow{
            id
        }
    }
    creator {
        ...ActivityPreviewUserCtx
    }
    likerCount
    myLike{
        id
    }
    myFlag{
        id
    }
}

fragment ActivityPreviewCommentCtxExtended on Comment{
    ...ActivityPreviewCommentCtxBase
    inReplyTo {
        ...ActivityPreviewCommentCtxBase
    }
    likerCount
    myLike{
        id
    }
    # myFlag{
    #     id
    # }
    thread {
        ...ActivityPreviewExtendedThread
    }
}
fragment ActivityPreviewCommentCtxBase on Comment{
    id
    isLocal
    content
    canonicalUrl
    createdAt
    creator {
        ...ActivityPreviewUserCtx
    }
    thread {
        ...ActivityPreviewBaseThread
    }
}

fragment ActivityPreviewCommunityCtx on Community{
    id
    isLocal
    icon
    name
    summary
    canonicalUrl
    myFollow{
        id
    }
    creator {
        ...ActivityPreviewUserCtx
    }
    likerCount
    myLike{
        id
    }
    myFlag{
        id
    }
}

fragment ActivityPreviewResourceCtx on Resource{
    id
    isLocal
    icon
    name
    summary
    canonicalUrl
    url
    collection{
        ...ActivityPreviewCollectionCtx
    }
    creator {
        ...ActivityPreviewUserCtx
    }
    likes{totalCount}
    myLike{
        id
    }
    myFlag{
        id
    }
}

fragment ActivityPreviewFlagCtx on Flag{
    isLocal
    context {
        ... on Collection{
            ...ActivityPreviewCollectionCtx
        }
        ... on Comment{
            ...ActivityPreviewCommentCtxBase
        }
        ... on Community{
            ...ActivityPreviewCommunityCtx
        }
        ... on Resource{
            ...ActivityPreviewResourceCtx
        }
        ... on User{
            ...ActivityPreviewUserCtx
        }
    }
}


fragment ActivityPreviewLikeCtx on Like{
    isLocal
    context {
        ... on Collection{
            ...ActivityPreviewCollectionCtx
        }
        ... on Comment{
            ...ActivityPreviewCommentCtxExtended
        }
        ... on Resource{
            ...ActivityPreviewResourceCtx
        }
        ... on User{
            ...ActivityPreviewUserCtx
        }
    }
}


fragment ActivityPreviewFollowCtx on Follow{
    isLocal
    context {
        ... on Collection{
            ...ActivityPreviewCollectionCtx
        }
        ... on Community{
            ...ActivityPreviewCommunityCtx
        }
        ... on User{
            ...ActivityPreviewUserCtx
        }
        ... on Thread{
            ...ActivityPreviewExtendedThread
        }
    }
}

fragment ActivityPreviewExtendedThread on Thread {
    ...ActivityPreviewBaseThread
    context {
        ... on Collection{
            ...ActivityPreviewCollectionCtx
        }

        ... on Community{
            ...ActivityPreviewCommunityCtx
        }

        ... on Resource{
            ...ActivityPreviewResourceCtx
        }

        ... on Flag{
            ...ActivityPreviewFlagCtx
        }
    }
}


mutation activityPreviewLike($contextId: String!) {
    createLike(contextId: $contextId){
        ...ActivityPreviewLikeMutationResult
    }
}
# fragment ActivityPreviewLikeMutationResult on Like {
#     ...ActivityPreviewLikeCtx
# }
fragment ActivityPreviewLikeMutationResult on Like {
    context {
        ... on Collection{
            likerCount
            myLike{id}
            id
        }
        ... on Comment{
            likerCount
            myLike{id}
            id
        }
        ... on Resource{
            likes{totalCount}
            myLike{id}
            id
        }
        ... on User{
            likerCount
            myLike{id}
            userId:id
        }
    }
}

mutation activityPreviewUnlike($contextId: String!) {
    delete(contextId: $contextId){
        ...ActivityPreviewUnlikeMutationResult
    }
}
fragment ActivityPreviewUnlikeMutationResult on Like {
    context {
        ... on Collection{
            likerCount
            myLike{id}
            id
        }
        ... on Comment{
            likerCount
            myLike{id}
            id
        }
        ... on Resource{
            likes{totalCount}
            myLike{id}
            id
        }
        ... on User{
            likerCount
            myLike{id}
            userId:id
        }
    }
}

mutation activityPreviewCreateReply( $comment: CommentInput!, $inReplyToId: String!, $threadId: String!) {
    createReply(comment: $comment, inReplyToId: $inReplyToId, threadId: $threadId){
        ...ActivityPreviewCreateReplyMutationResult
    }
}
fragment ActivityPreviewCreateReplyMutationResult on Comment {
        ...ActivityPreviewCommentCtxBase
}

mutation activityPreviewCreateThread($contextId: String!, $comment: CommentInput!) {
    createThread(comment:$comment, contextId: $contextId){
        ...ActivityPreviewCreateThreadMutationResult
    }
}
fragment ActivityPreviewCreateThreadMutationResult on Comment {
        ...ActivityPreviewCommentCtxBase
}


